<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Mister 36 Outlet Inventory</title>
  <style>
    .container { display: flex; gap: 50px; flex-wrap: wrap; }
    .page { width: 45%; border: 1px solid #aaa; padding: 10px; box-sizing: border-box; }
    h1, h2, h3 { text-align: center; margin: 10px 0; }
    ul { list-style: none; padding-left: 10px; margin: 0; }
    li { background: #f0f0f0; padding: 8px; margin: 5px 0; cursor: pointer; border-radius: 5px; }
    li:hover { background: #d0e0ff; }
    .folder { margin: 10px 0; padding: 5px; background: #f7f7f7; border: 1px dashed #aaa; border-radius: 4px; }
    .hint { font-size: 12px; text-align: center; opacity: 0.75; margin-top: -5px; }
    button { width: 100%; padding: 10px; cursor: pointer; margin-top: 10px; }
  </style>
</head>
<body>

<h1>Mister 36 Outlet Inventory</h1>
<div class="hint">Click an item to move it between <b>Items</b> and <b>Items To Buy</b>. Saved automatically.</div>

<div class="container">
  <div class="page">
    <h2>Items</h2>
    <div id="foldersA"></div>
  </div>

  <div class="page">
    <h2>Items To Buy</h2>
    <div id="foldersB"></div>
    <h3 id="totalPrice">Total: RM 0.00</h3>
    <button id="clearBtn">Clear Items To Buy</button>
  </div>
</div>

<script>
/** =====================
 * DATA: always use {price, qty}
 * ===================== */
const items = {
  "Frozen food": {
    "Hotdogs": { price: 18.00, qty: 1 },
    "Nuggets": { price: 14.50, qty: 1 },
    "Fries ðŸŸ": { price: 5.50, qty: 2 }
  },
  "Burger": {
    "Bun": { price: 3.00, qty: 3 },
    "Coral": { price: 5.00, qty: 1 },
    "Timun ðŸ¥’": { price: 3.00, qty: 1 },
    "Butter ðŸ§ˆ": { price: 8.00, qty: 1 },
    "Sliced Cheese ðŸ§€": { price: 16.60, qty: 1 },
    "Tissue": { price: 1.00, qty: 1 },
    "Kicap": { price: 6.50, qty: 1 },
    "Wrap": { price: 5.20, qty: 2 }
  },
  "Nasi Lemak": {
    "Kelapa Parut": { price: 3.00, qty: 2 },
    "Nuts ðŸ¥œ": { price: 8.00, qty: 1 },
    "Ikan Bilis": { price: 28.00, qty: 1 },
    "Dry Cili": { price: 7.00, qty: 1 },
    "Cukup Rasa": { price: 4.00, qty: 1 },
    "Lemon Grass": { price: 2.00, qty: 1 },
    "Rice ðŸŒ¾": { price: 19.00, qty: 1 },
    "Aji namoto": { price: 5.00, qty: 1 },
    "Asam Jawa": { price: 3.00, qty: 1 },
    "Garam": { price: 3.00, qty: 1 },
    "Gula Pasir": { price: 3.00, qty: 1 },
    "Cuka": { price: 3.00, qty: 1 },
    "Cube Ikan Bilis": { price: 5.00, qty: 1 },
    "Belacan": { price: 3.00, qty: 1 },
    "Bawang Merah": { price: 5.00, qty: 1 },
    "Bawang Putih": { price: 3.00, qty: 1 },
    "Pandan Leaves ðŸƒ": { price: 2.00, qty: 1 }
  },
  "Ayam Gunting": {
    "Chicken UN ðŸ—": { price: 45.00, qty: 1 },
    "Chicken Popcorn ðŸ¿": { price: 23.00, qty: 1 },
    "Chicken CF ðŸ—": { price: 43.00, qty: 1 }
  },
  "Lemon Soda ðŸ‹": {
    "Soda ðŸ¥¤": { price: 3.00, qty: 5 },
    "Plastic Bottel ðŸ¾ (10 pcs)": { price: 7.50, qty: 1 },
    "SunQuick": { price: 14.00, qty: 1 },
    "Lime ðŸ‹": { price: 2.00, qty: 1 },
    "Ice cube ðŸ§Š": { price: 3.50, qty: 2 },
    "Pudina": { price: 2.00, qty: 1 },
    "Chia Seed": { price: 7.50, qty: 1 }
  },
  "SOS": {
    "Mayo": { price: 10.90, qty: 1 },
    "Cili": { price: 6.00, qty: 1 },
    "BBQ": { price: 9.00, qty: 1 },
    "Cheese ðŸ§€": { price: 16.00, qty: 1 }
  },
  "Plastic": {
    "P.Small": { price: 2.00, qty: 1 },
    "P.Medium": { price: 3.00, qty: 1 },
    "P.Big": { price: 4.00, qty: 1 },
    "Cup Set": { price: 15.00, qty: 1 },
    "Straw": { price: 3.00, qty: 1 },
    "S.Container small": { price: 6.00, qty: 1 },
    "S.Container big": { price: 5.00, qty: 1 },
    "Spoon ðŸ¥„": { price: 3.00, qty: 1 },
    "Garbage Bag ðŸ—‘ï¸ ðŸ’¼": { price: 4.00, qty: 1 },
    "Cup Plastic ðŸ¥¤": { price: 2.00, qty: 1 }
  },
  "Flour": {
    "Starch": { price: 2.00, qty: 2 },
    "Bestari flour": { price: 9.00, qty: 1 },
    "W.Papper": { price: 8.00, qty: 1 },
    "Salt ðŸ§‚": { price: 2.00, qty: 1 },
    "Cili Powder": { price: 27.00, qty: 1 },
    "Paprika": { price: 31.00, qty: 1 }
  },
  "Others": {
    "Lunchbox": { price: 10.00, qty: 1 },
    "Styrofoam": { price: 9.00, qty: 1 },
    "Stick ðŸ¦¯": { price: 3.00, qty: 1 },
    "Rubber band": { price: 1.60, qty: 1 },
    "Gloves ðŸ§¤": { price: 3.00, qty: 1 },
    "Petrol gen": { price: 6.00, qty: 1 },
    "Petrol van ðŸš â›½ï¸": { price: 10.00, qty: 1 },
    "Petrol FZ â›½ï¸": { price: 12.00, qty: 1 },
    "2T": { price: 17.00, qty: 1 },
    "Spark plug ðŸ”Œ": { price: 12.00, qty: 1 },
    "Cooking Oil": { price: 7.50, qty: 1 },
    "Eggs ðŸ¥š": { price: 12.00, qty: 1 },
    "Gas â›½ï¸": { price: 29.00, qty: 1 },
    "Mask": { price: 10.00, qty: 1 },
    "DishWash": { price: 10.00, qty: 1 },
    "Detergent": { price: 10.00, qty: 1 },
    "Candle": { price: 3.00, qty: 1 },
    "Sambrani": { price: 5.00, qty: 1 },
    "MatchBox": { price: 4.00, qty: 1 },
    "Marker": { price: 2.60, qty: 1 },
    "TubeLight": { price: 9.00, qty: 1 },
    "Handwash": { price: 2.60, qty: 1 },
    "Spark-L": { price: 2.60, qty: 1 }
  }
};

/** =====================
 * SAFE STORAGE
 * ===================== */
const STORAGE_KEY = "m36_itemsToBuy_v2";

function loadSelected() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    const data = raw ? JSON.parse(raw) : [];
    return Array.isArray(data) ? data : [];
  } catch {
    return [];
  }
}
function saveSelected(data) {
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); } catch {}
}

/** =====================
 * SAFE IDs (no emoji, no spaces)
 * ===================== */
function folderIdFromName(folderName) {
  // keep only a-z, A-Z, 0-9; everything else becomes _
  return String(folderName)
    .normalize("NFKD")
    .replace(/[^a-zA-Z0-9]+/g, "_")
    .replace(/^_+|_+$/g, "");
}

function keyOf(folderId, itemName, idx) {
  return `${folderId}|||${itemName}|||${idx}`;
}

let selected = loadSelected();

function isSelected(folderId, itemName, idx) {
  return selected.some(i => keyOf(i.folderId, i.name, i.idx) === keyOf(folderId, itemName, idx));
}

function updateTotal() {
  const total = selected.reduce((sum, i) => sum + Number(i.price || 0), 0);
  document.getElementById("totalPrice").innerText = "Total: RM " + total.toFixed(2);
}

function moveItem(li, folderName, itemName, price, toBuy, idx) {
  const folderId = folderIdFromName(folderName);

  const fromList = document.getElementById(folderId + "_" + (toBuy ? "A" : "B"));
  const toList   = document.getElementById(folderId + "_" + (toBuy ? "B" : "A"));

  // if IDs failed, don't crash silently
  if (!fromList || !toList) {
    alert("Folder ID error. Try Clear Items To Buy, then refresh.");
    return;
  }

  fromList.removeChild(li);
  toList.appendChild(li);

  if (toBuy) {
    selected.push({ folderId, name: itemName, idx, price });
    li.onclick = () => moveItem(li, folderName, itemName, price, false, idx);
  } else {
    selected = selected.filter(i => keyOf(i.folderId, i.name, i.idx) !== keyOf(folderId, itemName, idx));
    li.onclick = () => moveItem(li, folderName, itemName, price, true, idx);
  }

  saveSelected(selected);
  updateTotal();
}

function createFolder(folderName, itemList) {
  const folderId = folderIdFromName(folderName);

  const divA = document.createElement("div");
  divA.className = "folder";
  divA.innerHTML = `<h3>ðŸ“‚ ${folderName}</h3><ul id="${folderId}_A"></ul>`;
  document.getElementById("foldersA").appendChild(divA);

  const divB = document.createElement("div");
  divB.className = "folder";
  divB.innerHTML = `<h3>ðŸ“‚ ${folderName}</h3><ul id="${folderId}_B"></ul>`;
  document.getElementById("foldersB").appendChild(divB);

  for (const [itemName, obj] of Object.entries(itemList)) {
    const price = Number(obj.price);
    const qty = Number(obj.qty || 1);

    for (let idx = 0; idx < qty; idx++) {
      const li = document.createElement("li");
      li.textContent = `${itemName} - RM${price.toFixed(2)}`;

      const already = isSelected(folderId, itemName, idx);
      li.onclick = () => moveItem(li, folderName, itemName, price, !already, idx);

      document.getElementById(`${folderId}_${already ? "B" : "A"}`).appendChild(li);
    }
  }
}

function renderAll() {
  document.getElementById("foldersA").innerHTML = "";
  document.getElementById("foldersB").innerHTML = "";

  // If old saved data doesn't match current folder IDs, wipe it (prevents â€œstuckâ€ bugs)
  const validFolderIds = new Set(Object.keys(items).map(folderIdFromName));
  selected = selected.filter(x => validFolderIds.has(x.folderId));
  saveSelected(selected);

  for (const [folderName, itemList] of Object.entries(items)) {
    createFolder(folderName, itemList);
  }
  updateTotal();
}

document.getElementById("clearBtn").onclick = () => {
  selected = [];
  saveSelected(selected);
  renderAll();
};

renderAll();
</script>

</body>
</html>
